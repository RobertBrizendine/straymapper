{% extends "base.html" %}

{% load bootstrap_toolkit %}

{% block extra_css %}
  #map{
    display: block;
    width: 95%;
    height: 400px;
    margin: 0 auto;
    -moz-box-shadow: 0px 5px 20px #ccc;
    -webkit-box-shadow: 0px 5px 20px #ccc;
    box-shadow: 0px 5px 20px #ccc;
  }

  /* GMaps bug- https://github.com/twitter/bootstrap/issues/2410 */
  #map img {
    max-width: none;
  }
{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{{STATIC_URL}}jquery-ui-1.8.21.custom/css/cupertino/jquery-ui-1.8.21.custom.css">

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="{{STATIC_URL}}jquery-ui-1.8.21.custom/js/jquery-ui-1.8.21.custom.min.js"></script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
  <script type="text/javascript" src='https://raw.github.com/HPNeo/gmaps/master/gmaps.js'></script>
  <script type="text/javascript">
    var map;
    $(document).ready(function(){
      map = new GMaps({
        div: '#map',
        zoom: 11,
        lat: 30.264998,
        lng: -97.691219
      });

      {% for animal in alist %}
        map.addMarker({
          lat: {{animal.geometry.y}},
          lng: {{animal.geometry.x}},
          title: '{{animal.animal_id}}',
          icon: '/static/images/small-marker.png',
          infoWindow: {
          content: "<table cellspacing='50%'><tr><td><p>{{animal.color|lower}}<br>{{animal.breed|lower}}<br>{{animal.sex}}<br />{{animal.location}}<br />age: {{animal.age}}<br/>intake total: {{animal.intake_total}}<br />intake condition: {{animal.intake_condition|lower}}</p></td><td><p align='right'><img src='http://www.petharbor.com/get_image.asp?RES=Thumb&ID={{animal.animal_id}}&LOCATION=ASTN'><br />{{animal.animal_id}}</p></td></tr></table>"
          }
        });

      {% endfor %}

      $('#id_intake_date').datepicker({dateFormat: 'yy-mm-dd'});

    });
  </script>
{% endblock %}

{% block content %}
<div class="hero-unit">
<h1>StrayMapper </h1>
  <p>The quick brown fox jumped over the lazy dog.</p>
</div>
<div class="row"> 
  <div class="span4">
  <form action="" method="POST">{% csrf_token %}
    {{form|as_bootstrap}}
    <input type="submit" value="Search" class="btn btn-primary">
  </form>
  <div>{{results_count}} animals displayed</div>
</div> 
<div class="span8"> 
Search Results<br /><br />
<table class="table" cellpadding="10">
<tr> 
  <td>Intake Date 
    </td>
<td>Color
    </td>
<td>Breed 
    </td>
<td>Type 
    </td>
<td>Sex 
    </td>
  {% for animal in alist|slice:":5" %} 
  <tr> 
    <td>{{animal.intake_date|date:"n/j/o"}}
    </td>
    <td>{{animal.color|lower}}
    </td>
    <td>{{animal.breed|lower}}
    </td>
    <td>{{animal.animal_type|lower}}
    </td>
    <td>{{animal.sex}}
    </td>
  </tr>
  {% endfor %}
</table>
</div>
</div>

<div class="row">
  <div class="span12">
    <div id="map"></div>
  </div>
</div>
<script src="http://codeforamerica.github.com/cfa_banner/banner.js?type=corner-right&forkUrl=https://github.com/codeforamerica/straymapper" id="cfa_banner_script"></script>
{% endblock %}
